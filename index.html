<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Dashboard OEE - POPRAWIONE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Style pozostają bez zmian */
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 0; padding: 10px; }
        .container { max-width: 100%; margin: auto; background: white; padding: 10px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        /* ... (reszta CSS bez zmian) ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- Nagłówek i selektor -->
        <table>
            <tr>
                <td id="mainDisplayField"><strong>Wybierz linię</strong></td>
                <td colspan="4">
                    <select id="sheetSelector">
                        <option value="">Wybierz linię</option>
                        <option>NHL</option>
                        <option>MP4</option>
                        <!-- ... (reszta opcji) ... -->
                    </select>
                </td>
            </tr>
            <!-- Tabela danych -->
            <tr>
                <td><strong>zm</strong></td>
                <td>I</td><td>II</td><td>III</td>
                <td><strong>TOTAL</strong></td>
            </tr>
            <tr>
                <td><strong>OEE</strong></td>
                <td id="oeeShift1" class="data-field"></td>
                <td id="oeeShift2" class="data-field"></td>
                <td id="oeeShift3" class="data-field"></td>
                <td id="oeeTotal" class="data-field"></td>
            </tr>
            <!-- ... (reszta tabeli) ... -->
        </table>
        
        <!-- Sekcje godzinowe -->
        <div class="time-block">
            <table class="time-table">
                <!-- ... (godziny 6-13) ... -->
            </table>
        </div>
        <!-- ... (pozostałe sekcje godzinowe) ... -->
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sheetId = '1gcWHcIZv7OMuU1bNNQ5P7XFLNpLoBsabXbG9hJImGpc';
    const sheetSelector = document.getElementById('sheetSelector');
    const mainDisplayField = document.getElementById('mainDisplayField');

    // Funkcja formatująca datę (specjalnie dla Twojego formatu)
    function formatDate(value) {
        if (!value) return '';
        
        // Usuń zbędne cudzysłowy i spacje
        value = value.toString().replace(/["']/g, '').trim();
        
        // Format: '2025-06-03 00:00:00' -> '03.06.2025'
        const parts = value.match(/^(\d{4})-(\d{2})-(\d{2})/);
        if (parts) return `${parts[3]}.${parts[2]}.${parts[1]}`;
        
        return value;
    }

    // Mapowanie KOMÓRKA_HTML -> { wiersz, kolumna, czyData }
    const cellMap = {
        // Główna data (C1 w arkuszu)
        'mainDisplayField': { row: 1, col: 'C', isDate: true },
        
        // OEE (wiersz 3 w arkuszu)
        'oeeTotal': { row: 3, col: 'C' }, // TOTAL
        'oeeShift1': { row: 3, col: 'D' }, // I
        'oeeShift2': { row: 3, col: 'E' }, // II
        'oeeShift3': { row: 3, col: 'F' }, // III
        
        // OK (wiersz 4)
        'okTotal': { row: 4, col: 'C' },
        'okShift1': { row: 4, col: 'D' },
        'okShift2': { row: 4, col: 'E' },
        'okShift3': { row: 4, col: 'F' },
        
        // NOK (wiersz 5)
        'nokTotal': { row: 5, col: 'C' },
        'nokShift1': { row: 5, col: 'D' },
        'nokShift2': { row: 5, col: 'E' },
        'nokShift3': { row: 5, col: 'F' },
        
        // Godziny - WIERSZ 1 (np. E7)
        'h6_r1': { row: 7, col: 'E' },
        'h7_r1': { row: 8, col: 'E' },
        // ... (reszta godzin r1)
        
        // Godziny - WIERSZ 2 (np. C7)
        'h6_r2': { row: 7, col: 'C' },
        'h7_r2': { row: 8, col: 'C' },
        // ... (reszta godzin r2)
    };

    // Pobierz dane z Google Sheets
    async function loadData() {
        const sheetName = sheetSelector.value;
        if (!sheetName) return;
        
        try {
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
            const response = await fetch(url);
            const csvData = await response.text();
            
            // Przetwórz CSV
            const rows = csvData.split('\n').map(row => row.split(','));
            
            // Wypełnij dane
            for (const [elementId, {row, col, isDate}] of Object.entries(cellMap)) {
                const cellValue = rows[row-1] ? rows[row-1][col.charCodeAt(0) - 65] : '';
                document.getElementById(elementId).textContent = isDate ? formatDate(cellValue) : cellValue;
            }
            
        } catch (error) {
            console.error("Błąd:", error);
            alert("Błąd ładowania danych!");
        }
    }

    // Inicjalizacja
    sheetSelector.addEventListener('change', loadData);
});
</script>
</body>
</html>
